{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\jaina\\\\OneDrive\\\\Desktop\\\\Sweet-Shop-Mangement-System\\\\sweet-shop-frontend\\\\src\\\\context\\\\AuthContext.tsx\",\n  _s = $RefreshSig$();\n// src/context/AuthContext.tsx\n\nimport React, { createContext, useState, useEffect } from 'react';\nimport api from '../api/index.ts'; // Your configured Axios instance\nimport { useNavigate } from 'react-router-dom';\n\n// --- Type Definitions ---\n\n// Define the User structure based on your FastAPI User schema\n\n// Define the shape of the context values\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n// Initial/default context value\nconst AuthContext = /*#__PURE__*/createContext(undefined);\n\n// --- Auth Provider Component ---\n\nexport const AuthProvider = ({\n  children\n}) => {\n  _s();\n  const [user, setUser] = useState(null);\n  const [token, setToken] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const navigate = useNavigate();\n\n  // 1. Initial Load: Check localStorage for token\n  useEffect(() => {\n    const storedToken = localStorage.getItem('token');\n    if (storedToken) {\n      setToken(storedToken);\n      // Attempt to fetch user details to validate token\n      fetchUser(storedToken);\n    } else {\n      setLoading(false);\n    }\n  }, []);\n\n  // 2. Fetch User Details based on Token\n  const fetchUser = async authToken => {\n    try {\n      // Set the Authorization header for the request\n      api.defaults.headers.common['Authorization'] = `Bearer ${authToken}`;\n\n      // This assumes you have a GET /api/users/me endpoint configured in your backend\n      const response = await api.get('/users/me');\n      setUser(response.data);\n      setLoading(false);\n    } catch (error) {\n      console.error('Token validation failed, logging out.');\n      // If fetching /me fails (token expired/invalid), clear everything\n      clearAuthData();\n      setLoading(false);\n    }\n  };\n\n  // 3. Clear all auth data\n  const clearAuthData = () => {\n    localStorage.removeItem('token');\n    setToken(null);\n    setUser(null);\n    delete api.defaults.headers.common['Authorization'];\n  };\n\n  // 4. Login function\n  const login = (authToken, redirectPath = '/') => {\n    localStorage.setItem('token', authToken);\n    setToken(authToken);\n    fetchUser(authToken);\n    navigate(redirectPath, {\n      replace: true\n    });\n  };\n\n  // 5. Logout function\n  const logout = () => {\n    clearAuthData();\n    navigate('/login');\n  };\n  const contextValue = {\n    user,\n    token,\n    isAuthenticated: !!token && !!user,\n    // User is authenticated only if both token and user object exist\n    login,\n    logout\n  };\n  if (loading) {\n    // Simple loading screen while validating the token\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"text-center mt-5\",\n      children: \"Loading session...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 16\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: contextValue,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 103,\n    columnNumber: 9\n  }, this);\n};\n_s(AuthProvider, \"RxmIdFOZc61GzKaNhH0Of3r4pH4=\", false, function () {\n  return [useNavigate];\n});\n_c = AuthProvider;\nexport { AuthContext };\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["React","createContext","useState","useEffect","api","useNavigate","jsxDEV","_jsxDEV","AuthContext","undefined","AuthProvider","children","_s","user","setUser","token","setToken","loading","setLoading","navigate","storedToken","localStorage","getItem","fetchUser","authToken","defaults","headers","common","response","get","data","error","console","clearAuthData","removeItem","login","redirectPath","setItem","replace","logout","contextValue","isAuthenticated","className","fileName","_jsxFileName","lineNumber","columnNumber","Provider","value","_c","$RefreshReg$"],"sources":["C:/Users/jaina/OneDrive/Desktop/Sweet-Shop-Mangement-System/sweet-shop-frontend/src/context/AuthContext.tsx"],"sourcesContent":["// src/context/AuthContext.tsx\r\n\r\nimport React, { createContext, useState, useEffect } from 'react';\r\nimport api from '../api/index.ts'; // Your configured Axios instance\r\nimport { useNavigate } from 'react-router-dom';\r\n\r\n// --- Type Definitions ---\r\n\r\n// Define the User structure based on your FastAPI User schema\r\ninterface User {\r\n    email: string;\r\n    id: number;\r\n    is_admin: boolean; // Crucial for AdminRoute\r\n}\r\n\r\n// Define the shape of the context values\r\ninterface AuthContextType {\r\n    user: User | null;\r\n    token: string | null;\r\n    isAuthenticated: boolean;\r\n    login: (token: string, redirectPath?: string) => void;\r\n    logout: () => void;\r\n}\r\n\r\n// Initial/default context value\r\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\r\n\r\n// --- Auth Provider Component ---\r\n\r\nexport const AuthProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\r\n    const [user, setUser] = useState<User | null>(null);\r\n    const [token, setToken] = useState<string | null>(null);\r\n    const [loading, setLoading] = useState(true);\r\n    const navigate = useNavigate();\r\n\r\n    // 1. Initial Load: Check localStorage for token\r\n    useEffect(() => {\r\n        const storedToken = localStorage.getItem('token');\r\n        if (storedToken) {\r\n            setToken(storedToken);\r\n            // Attempt to fetch user details to validate token\r\n            fetchUser(storedToken); \r\n        } else {\r\n            setLoading(false);\r\n        }\r\n    }, []);\r\n\r\n    // 2. Fetch User Details based on Token\r\n    const fetchUser = async (authToken: string) => {\r\n        try {\r\n            // Set the Authorization header for the request\r\n            api.defaults.headers.common['Authorization'] = `Bearer ${authToken}`;\r\n            \r\n            // This assumes you have a GET /api/users/me endpoint configured in your backend\r\n            const response = await api.get<User>('/users/me'); \r\n            \r\n            setUser(response.data);\r\n            setLoading(false);\r\n        } catch (error) {\r\n            console.error('Token validation failed, logging out.');\r\n            // If fetching /me fails (token expired/invalid), clear everything\r\n            clearAuthData();\r\n            setLoading(false);\r\n        }\r\n    };\r\n    \r\n    // 3. Clear all auth data\r\n    const clearAuthData = () => {\r\n        localStorage.removeItem('token');\r\n        setToken(null);\r\n        setUser(null);\r\n        delete api.defaults.headers.common['Authorization'];\r\n    };\r\n\r\n    // 4. Login function\r\n    const login = (authToken: string, redirectPath: string = '/') => {\r\n        localStorage.setItem('token', authToken);\r\n        setToken(authToken);\r\n        fetchUser(authToken);\r\n        navigate(redirectPath, { replace: true });\r\n    };\r\n\r\n    // 5. Logout function\r\n    const logout = () => {\r\n        clearAuthData();\r\n        navigate('/login');\r\n    };\r\n\r\n    const contextValue: AuthContextType = {\r\n        user,\r\n        token,\r\n        isAuthenticated: !!token && !!user, // User is authenticated only if both token and user object exist\r\n        login,\r\n        logout,\r\n    };\r\n\r\n    if (loading) {\r\n        // Simple loading screen while validating the token\r\n        return <div className=\"text-center mt-5\">Loading session...</div>;\r\n    }\r\n\r\n    return (\r\n        <AuthContext.Provider value={contextValue}>\r\n            {children}\r\n        </AuthContext.Provider>\r\n    );\r\n};\r\n\r\nexport { AuthContext };"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}